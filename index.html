<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>MapTiler Geocoding control</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.0/leaflet.umd.js"></script>
    <link
      href="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.0/style.css"
      rel="stylesheet"
    />
    <style>
      #map {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <div id="map">
      <a
        href="https://www.maptiler.com"
        style="position: absolute; left: 10px; bottom: 10px; z-index: 999"
        ><img
          src="https://api.maptiler.com/resources/logo.svg"
          alt="MapTiler logo"
      /></a>
    </div>
    <p>
      <a
        href="https://www.maptiler.com/copyright/"
        target="_blank"
        rel="noopener"
        >&copy; MapTiler</a
      >
      <a
        href="https://www.openstreetmap.org/copyright"
        target="_blank"
        rel="noopener"
        >&copy; OpenStreetMap contributors</a
      >
    </p>
    <script>
      let map; // Declare map variable outside to ensure it is available globally
      let userLocation = [];
      const key = "QCbtwJjYBCNXTirCzTcI"; // api key to access map location

      function initializeMap() {
        map = L.map("map").setView(userLocation, 14); // Set the view with userLocation once it's available

        // using marker to highlight area on map
        var marker = L.marker(userLocation).addTo(map);

        // using a polygon to highlight area on map
        var circle = L.circle(userLocation, {
          color: "red",
          fillColor: "#f03",
          fillOpacity: 0.5,
          radius: 500,
        }).addTo(map);

        // set tile layer for map, i used mapTiler
        L.tileLayer(
          `https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=${key}`,
          {
            tileSize: 512,
            zoomOffset: -1,
            minZoom: 1,
            attribution:
              '&copy; <a href="https://www.maptiler.com/copyright/" target="_blank">MapTiler</a> ' +
              '&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap contributors</a>',
            crossOrigin: true,
          }
        ).addTo(map);
        L.control.maptilerGeocoding({ apiKey: key }).addTo(map);
      }

      // access user location and set it in setView
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            userLocation = [
              position.coords.latitude,
              position.coords.longitude,
            ];
            initializeMap(); // Initialize the map once location is retrieved
          },
          function (error) {
            console.error("Error getting location", error);
            userLocation = [defaultLatitude, defaultLongitude]; 
            // Default location if error
            initializeMap();
          }
        );
      } else {
        console.log("Geolocation is not supported by this browser.");
      }
    </script>
  </body>
</html>
